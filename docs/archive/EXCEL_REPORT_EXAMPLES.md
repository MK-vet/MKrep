# Excel Report Examples and Structure

## Overview

This document provides detailed examples of the Excel reports generated by each analysis script, including sheet structures and data formats.

## Common Structure Across All Reports

Every Excel report contains these standardized sheets:

### 1. Metadata Sheet
Contains analysis configuration and execution details:

| Report Information | Value |
|-------------------|-------|
| Analysis Script | [Script name] |
| Analysis Date | 2025-01-07 12:30:45 |
| Output Folder | ./output |
| Number of PNG Charts Generated | 5 |
| [Additional parameters...] | [Values...] |

### 2. Methodology Sheet
Detailed descriptions of all analytical methods:

| Section | Description |
|---------|-------------|
| Method 1 | Detailed explanation of the statistical method... |
| Method 2 | Description of the algorithm... |
| Statistical Tests | Chi-square, Fisher exact, FDR correction... |

### 3. Chart_Index Sheet
List of all generated PNG files:

| Chart Number | Filename | Full Path |
|--------------|----------|-----------|
| 1 | network_3d_visualization.png | ./output/png_charts/network_3d_visualization.png |
| 2 | phylogenetic_tree.png | ./output/png_charts/phylogenetic_tree.png |

## Script-Specific Report Structures

### Network_Analysis_2025_06_26.py

**Excel File Name:** `Network_Analysis_Report_<timestamp>.xlsx`

**Sheets:**
1. **Metadata** - Analysis configuration
2. **Methodology** - Chi-square/Fisher tests, Entropy, Cramér's V, Network analysis
3. **Feature_Summary** - Overview of all feature categories
   ```
   Category | Number_of_Features
   MGE      | 15
   MIC      | 24
   MLST     | 8
   ```

4. **Chi2_Results** - Statistical test results
   ```
   Feature1 | Feature2 | P-value | Phi | FDR_Corrected | Significant
   Gene_A   | Gene_B   | 0.001   | 0.45| 0.005        | True
   ```

5. **Entropy_Results** - Information content
   ```
   Feature  | Entropy | Category
   Gene_A   | 0.85    | AMR
   Gene_B   | 0.92    | Virulence
   ```

6. **Cramers_V_Results** - Association strength
   ```
   Feature1 | Feature2 | Cramers_V | P-value | FDR | Significant
   Gene_A   | Gene_B   | 0.42      | 0.001   | 0.01| True
   ```

7. **Exclusive_Pairs_k2** - Mutually exclusive pairs
   ```
   Feature1 | Feature2 | Co-occurrence | P-value | FDR
   Gene_A   | Gene_B   | 0.02         | 0.001   | 0.01
   ```

8. **Network_Analysis** - Node properties
   ```
   Feature  | Category | Cluster | Degree_Centrality | Betweenness | Closeness | Eigenvector
   Gene_A   | AMR      | 1       | 0.45             | 0.32        | 0.67      | 0.28
   ```

9. **Cluster_Hubs** - Highly connected features
   ```
   Feature  | Cluster | Degree_Centrality | Hub_Score
   Gene_A   | 1       | 0.78             | 0.92
   ```

10. **Chart_Index** - PNG file listing

**PNG Charts:**
- `network_3d_visualization.png` - 3D network with cluster colors (1400x1000 pixels)

---

### MDR_2025_04_15.py

**Excel File Name:** `MDR_Analysis_Hybrid_Report_<timestamp>.xlsx`

**Sheets:**
1. **Metadata** - Analysis parameters including total isolates, MDR count, bootstrap iterations
2. **Methodology** - Bootstrap resampling, Association testing, Network construction
3. **Dataset_Overview** - Summary statistics
   ```
   Metric                | Value
   Total Isolates        | 250
   MDR Isolates          | 89
   MDR Percentage        | 35.60%
   Phenotype Columns     | 12
   Gene Columns          | 45
   ```

4. **Freq_Pheno_All** - Phenotypic resistance frequencies (all isolates)
   ```
   Phenotype      | Frequency | Lower_CI_95 | Upper_CI_95
   Ampicillin_R   | 0.68      | 0.62        | 0.74
   Tetracycline_R | 0.45      | 0.39        | 0.51
   ```

5. **Freq_Pheno_MDR** - Phenotypic resistance frequencies (MDR only)
6. **Freq_Gene_All** - AMR gene frequencies (all isolates)
7. **Freq_Gene_MDR** - AMR gene frequencies (MDR only)
8. **Patterns_Pheno_MDR** - Resistance patterns
   ```
   Pattern                    | Count | Frequency | Lower_CI | Upper_CI
   Amp+Tet+Chlor             | 23    | 0.26      | 0.18     | 0.35
   ```

9. **Coocc_Pheno_MDR** - Phenotype co-occurrence matrix
10. **Coocc_Gene_MDR** - Gene co-occurrence matrix
11. **Gene_Pheno_Assoc** - Gene-phenotype associations
    ```
    Gene      | Phenotype      | Phi  | P-value | FDR   | Significant
    blaTEM    | Ampicillin_R  | 0.82 | <0.001  | 0.001 | True
    ```

12. **Assoc_Rules_Pheno** - Association rules for phenotypes
    ```
    Antecedent     | Consequent    | Support | Confidence | Lift
    Amp_R          | Tet_R         | 0.35    | 0.82       | 1.8
    ```

13. **Network_Edges** - Significant network edges
14. **Network_Communities** - Louvain communities
15. **Network_Stats** - Overall network metrics

**PNG Charts:**
- `hybrid_network_visualization.png` - Phenotype-gene network (1400x1000 pixels)

---

### Cluster_MIC_AMR_Viruelnce.py

**Excel File Name:** `Cluster_Analysis_Report_<timestamp>.xlsx`

**Sheets:**
1. **Metadata** - Total strains, categories analyzed, cluster counts per category
2. **Methodology** - K-Modes clustering, Chi-square tests, MCA, RF importance
3. **Integrated_Clusters** - Cluster assignments across all categories
   ```
   Strain_ID | MIC_Cluster | AMR_Cluster | Virulence_Cluster
   ST001     | 1           | 2           | 1
   ST002     | 2           | 1           | 3
   ```

4. **MIC_Clusters** - Cluster assignments for MIC category
   ```
   Strain_ID | Cluster | Silhouette_Score
   ST001     | 1       | 0.65
   ```

5. **MIC_Chi2** - Chi-square results for MIC features
   ```
   Feature     | Cluster | Chi2_Stat | P-value | FDR   | Significant
   Ampicillin  | 1       | 45.2      | <0.001  | 0.001 | True
   ```

6. **MIC_LogOdds** - Log-odds ratios with bootstrap CIs
   ```
   Feature     | Cluster | LogOdds | Lower_CI_95 | Upper_CI_95
   Ampicillin  | 1       | 2.34    | 1.89        | 2.78
   ```

7. **MIC_RF_Import** - Random Forest feature importance
   ```
   Feature     | Importance_Mean | Importance_Std | Rank
   Ampicillin  | 0.145          | 0.023          | 1
   ```

8. **MIC_Assoc_Rules** - Association rules
   ```
   Antecedent  | Consequent  | Support | Confidence | Lift
   Amp_R       | Tet_R       | 0.42    | 0.85       | 1.9
   ```

9. **MIC_MCA** - MCA coordinates
   ```
   Strain_ID | Component_1 | Component_2 | Cluster
   ST001     | -0.45       | 0.32        | 1
   ```

10-17. Similar sheets for AMR and Virulence categories
18. **Chart_Index** - PNG file listing

**PNG Charts:**
- `mca_scatter_MIC.png` - MCA visualization for MIC clusters
- `heatmap_AMR.png` - Correlation heatmap for AMR genes
- `mca_scatter_Virulence.png` - MCA visualization for virulence factors

---

### StrepSuisPhyloCluster_2025_08_11.py

**Excel File Name:** `StrepSuisPhyloCluster_Report_<timestamp>.xlsx`

**Sheets:**
1. **Metadata** - Tree file, UMAP parameters, outlier settings
2. **Methodology** - Tree-aware clustering, Evolutionary metrics, Trait profiling
3. **phylogenetic_clusters** - Main cluster assignments
   ```
   Strain_ID | Cluster | Method        | Silhouette_Score
   ST001     | 1       | TreeCluster   | 0.72
   ```

4. **outlier_detection** - Outlier identification results
   ```
   Strain_ID | Outlier_Score | Is_Outlier
   ST001     | -0.12         | False
   ```

5. **phylogenetic_diversity** - PD metrics per cluster
   ```
   Cluster | PD    | Mean_Pairwise_Distance | Samples
   1       | 0.045 | 0.012                 | 45
   ```

6. **trait_chi2_results** - Trait associations
   ```
   Trait    | Cluster | Chi2_Stat | P-value | FDR_Corrected
   aac6     | 1       | 23.5      | 0.001   | 0.01
   ```

7. **feature_importance_[category]** - RF importance scores
8. **association_rules_[category]** - Trait association rules
9. Additional CSV files from analysis

**PNG Charts:**
- `phylogenetic_tree.png` - Tree with color-coded clusters (saved via matplotlib)

---

### Phylogenetic_clustering_2025_03_21.py

**Excel File Name:** `Phylogenetic_Clustering_Report_<timestamp>.xlsx`

**Sheets:**
1. **Metadata** - Complete configuration including all file paths and parameters
2. **Methodology** - Comprehensive descriptions of all 8+ methods
3. **phylogenetic_clusters** - Primary clustering results
   ```
   Strain_ID | Cluster | Clustering_Method | Silhouette
   ST001     | 1       | TreeBased        | 0.68
   ```

4. **outliers_detected** - Isolation Forest results
5. **phylogenetic_distances** - Pairwise patristic distances
   ```
   Strain_1 | Strain_2 | Distance
   ST001    | ST002    | 0.0234
   ```

6. **faith_pd_per_cluster** - Phylogenetic diversity
   ```
   Cluster | Faith_PD | N_Strains | Mean_Distance
   1       | 0.156    | 42        | 0.034
   ```

7. **trait_analysis_chi2** - Binary trait associations
8. **trait_analysis_logodds** - Effect sizes
9. **trait_importance_bootstrap** - RF importance with CIs
10. **association_rules_traits** - Trait patterns
11. **mca_coordinates** - MCA dimensionality reduction
12. **umap_embedding** - UMAP coordinates
    ```
    Strain_ID | UMAP1  | UMAP2  | Cluster
    ST001     | -2.45  | 1.32   | 1
    ```

**PNG Charts:**
- `phylogenetic_tree.png` - Color-coded dendrogram (high DPI)
- `umap_embedding.png` - 2D UMAP scatter plot

---

## Data Quality and Formatting

### Numeric Precision
- All numeric values rounded to 4 decimal places
- P-values formatted in scientific notation when < 0.0001
- Confidence intervals consistently formatted

### Column Widths
- Automatically adjusted to content
- Maximum width capped at 50 characters for readability
- Strain_ID column typically 15 characters wide

### Missing Data
- Represented as empty cells (not "NA" or "NaN")
- Maintains data type consistency

### Sheet Names
- Maximum 31 characters (Excel limitation)
- Invalid characters (`:`, `\`, `/`, `?`, `*`, `[`, `]`) replaced with `_`
- Descriptive and consistent across reports

## PNG Chart Specifications

### Matplotlib Figures
- **Format**: PNG
- **DPI**: 150 (publication quality)
- **Size**: Varies by plot type, typically 8x6 inches
- **Color**: High-contrast color schemes
- **Font sizes**: Optimized for readability

### Plotly Figures
- **Format**: PNG (via kaleido) or HTML (fallback)
- **Dimensions**: 1200x800 pixels or 1400x1000 for complex plots
- **Scale**: 2x for high resolution
- **Interactive**: When saved as HTML, maintains interactivity

## File Size Considerations

Typical Excel file sizes:
- Small dataset (50-100 samples): 50-200 KB
- Medium dataset (100-500 samples): 200-800 KB
- Large dataset (500-1000 samples): 800 KB - 3 MB
- Very large dataset (>1000 samples): 3-10 MB

PNG chart sizes:
- Simple plots: 50-200 KB
- Complex network visualizations: 200-500 KB
- High-resolution phylogenetic trees: 500 KB - 2 MB

## Usage Tips

1. **Open in Excel/LibreOffice**: Double-click the .xlsx file
2. **View Charts**: Navigate to Chart_Index sheet for PNG file locations
3. **Filter Data**: Use Excel's built-in filtering on any data sheet
4. **Create Pivot Tables**: All sheets are pivot-table ready
5. **Export Subsets**: Copy specific sheets to separate workbooks if needed
6. **Combine Results**: Multiple analysis runs can be merged in Excel

## Compatibility

- ✅ Microsoft Excel 2010 and later
- ✅ Google Sheets (with minor formatting differences)
- ✅ LibreOffice Calc 6.0 and later
- ✅ Apple Numbers (with some limitations)

## Common Analysis Workflows

### Example 1: Compare Clusters Across Categories
1. Open Integrated_Clusters sheet
2. Create pivot table with Strain_ID as rows
3. Add cluster columns as values
4. Identify strains with consistent clustering

### Example 2: Identify Top Features
1. Open Feature_Importance sheets
2. Sort by Importance_Mean (descending)
3. Filter for Importance_Mean > threshold
4. Export to separate sheet

### Example 3: Validate Associations
1. Open Chi2_Results or Gene_Pheno_Assoc
2. Filter for Significant == True
3. Sort by Phi or effect size
4. Cross-reference with biological literature

## Troubleshooting

**Issue**: Excel file won't open
- Check file size (Excel has 1M row limit)
- Verify file extension is .xlsx
- Try opening with LibreOffice if Excel fails

**Issue**: Charts not found
- Verify png_charts folder exists
- Check Chart_Index sheet for correct paths
- Ensure PNG files weren't moved/deleted

**Issue**: Formatting looks wrong
- Check Excel version (2010+ recommended)
- Verify no special characters in file path
- Try re-opening with different application

## Future Enhancements

Potential improvements for future versions:
- Direct chart embedding in Excel sheets
- Conditional formatting for statistical significance
- Hyperlinked chart references from data sheets
- Summary dashboard with key metrics
- Multi-workbook reports for very large datasets
